<!DOCTYPE html>
<html class="writer-html5" lang="en" >
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>ads.citi_to_touchstone &mdash; TheSyDeKick 1.8_RC documentation</title>
      <link rel="stylesheet" href="../../_static/pygments.css" type="text/css" />
      <link rel="stylesheet" href="../../_static/css/theme.css" type="text/css" />
  <!--[if lt IE 9]>
    <script src="../../_static/js/html5shiv.min.js"></script>
  <![endif]-->
  
        <script data-url_root="../../" id="documentation_options" src="../../_static/documentation_options.js"></script>
        <script src="../../_static/jquery.js"></script>
        <script src="../../_static/underscore.js"></script>
        <script src="../../_static/_sphinx_javascript_frameworks_compat.js"></script>
        <script src="../../_static/doctools.js"></script>
    <script src="../../_static/js/theme.js"></script>
    <link rel="index" title="Index" href="../../genindex.html" />
    <link rel="search" title="Search" href="../../search.html" /> 
</head>

<body class="wy-body-for-nav"> 
  <div class="wy-grid-for-nav">
    <nav data-toggle="wy-nav-shift" class="wy-nav-side">
      <div class="wy-side-scroll">
        <div class="wy-side-nav-search" >
            <a href="../../index.html" class="icon icon-home"> TheSyDeKick
          </a>
<div role="search">
  <form id="rtd-search-form" class="wy-form" action="../../search.html" method="get">
    <input type="text" name="q" placeholder="Search docs" />
    <input type="hidden" name="check_keywords" value="yes" />
    <input type="hidden" name="area" value="default" />
  </form>
</div>
        </div><div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="Navigation menu">
              <p class="caption" role="heading"><span class="caption-text">Contents:</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../../introduction.html">Introduction to TheSyDeKick</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../thesdk/sections.html">Thesdk core classes</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../rtl/sections.html">RTL interface classes</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../spice/sections.html">Spice simulator interface classess</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../inverter/sections.html">Inverter class</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../inverter_testbench/sections.html">Inverter testbench class</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../inverter_tests/sections.html">Inverter tests class</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../ads/sections.html">ADS interface</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../ads_template/sections.html">ADS template class</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../examples.html">Examples</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../documentation_instructions.html">Documentation instructions</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../indices_and_tables.html">Indices and tables</a></li>
</ul>

        </div>
      </div>
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap"><nav class="wy-nav-top" aria-label="Mobile navigation menu" >
          <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
          <a href="../../index.html">TheSyDeKick</a>
      </nav>

      <div class="wy-nav-content">
        <div class="rst-content">
          <div role="navigation" aria-label="Page navigation">
  <ul class="wy-breadcrumbs">
      <li><a href="../../index.html" class="icon icon-home"></a> &raquo;</li>
          <li><a href="../index.html">Module code</a> &raquo;</li>
          <li><a href="../ads.html">ads</a> &raquo;</li>
      <li>ads.citi_to_touchstone</li>
      <li class="wy-breadcrumbs-aside">
      </li>
  </ul>
  <hr/>
</div>
          <div role="main" class="document" itemscope="itemscope" itemtype="http://schema.org/Article">
           <div itemprop="articleBody">
             
  <h1>Source code for ads.citi_to_touchstone</h1><div class="highlight"><pre>
<span></span><span class="sd">&#39;&#39;&#39;</span>
<span class="sd">==================</span>
<span class="sd">Citi to Touchstone</span>
<span class="sd">==================</span>
<span class="sd">Citifile to Touchstone fileformat converter</span>

<span class="sd">Currently tested with 1, 2, 3, 4, 10 and 17-port citifile generated by Momentum.</span>
<span class="sd">The generated Touchstone .sNp files have been tested using Python scikit-rf library and</span>
<span class="sd">ADS data file tool.</span>

<span class="sd">CITIFile documentation:</span>
<span class="sd">http://literature.cdn.keysight.com/litweb/pdf/ads15/cktsim/ck2016.html</span>

<span class="sd">Touchstone documentation:</span>
<span class="sd">http://literature.cdn.keysight.com/litweb/pdf/genesys200801/sim/linear_sim/sparams/touchstone_file_format.htm</span>


<span class="sd">Initially written by Veeti Lahtinen 2021</span>

<span class="sd">&#39;&#39;&#39;</span>
<span class="kn">from</span> <span class="nn">thesdk</span> <span class="kn">import</span> <span class="o">*</span>
<span class="kn">from</span> <span class="nn">ads</span> <span class="kn">import</span> <span class="o">*</span>

<span class="kn">import</span> <span class="nn">os</span>
<span class="kn">import</span> <span class="nn">sys</span>
<span class="kn">import</span> <span class="nn">numpy</span> <span class="k">as</span> <span class="nn">np</span>
<span class="kn">import</span> <span class="nn">time</span>

<div class="viewcode-block" id="citi_to_touchstone"><a class="viewcode-back" href="../../ads/sections.html#ads.citi_to_touchstone.citi_to_touchstone">[docs]</a><span class="k">class</span> <span class="nc">citi_to_touchstone</span><span class="p">(</span><span class="n">thesdk</span><span class="p">):</span>    
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    This class parses a citifile (.cti) file and writes the data to a Touchstone (.sNp) file.</span>
<span class="sd">    This class is utilized by the main ads class.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="nd">@property</span>
    <span class="k">def</span> <span class="nf">_classfile</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">return</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">dirname</span><span class="p">(</span><span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">realpath</span><span class="p">(</span><span class="vm">__file__</span><span class="p">))</span> <span class="o">+</span> <span class="s2">&quot;/&quot;</span><span class="o">+</span><span class="vm">__name__</span>

    <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>
        <span class="k">pass</span>
    
    <span class="nd">@property</span>
    <span class="k">def</span> <span class="nf">input_file</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&#39;&#39;&#39;String</span>
<span class="sd">        </span>
<span class="sd">        Path to the CITIfile to convert (&#39;self.adssrc/proj.cti&#39;)</span>
<span class="sd">        </span>
<span class="sd">        Should be given in run_ads!</span>
<span class="sd">        &#39;&#39;&#39;</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="nb">hasattr</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="s1">&#39;_input_file&#39;</span><span class="p">):</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_input_file</span><span class="o">=</span><span class="s1">&#39;&#39;</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_input_file</span>
    <span class="nd">@input_file</span><span class="o">.</span><span class="n">setter</span>
    <span class="k">def</span> <span class="nf">input_file</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="n">value</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_input_file</span><span class="o">=</span><span class="n">value</span>

    <span class="nd">@property</span>
    <span class="k">def</span> <span class="nf">output_file</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&#39;&#39;&#39; String</span>

<span class="sd">        Path to the output touchstone file to be generated (&#39;self.adssimpath/self.sparam_filename&#39;)</span>

<span class="sd">        Should be given in run_ads!</span>
<span class="sd">        </span>
<span class="sd">        Give the sparam_filename without the .sNp extension, because the name depends on the number</span>
<span class="sd">        of ports in the layout! This is automatically generated in self.output_file_extension!!</span>
<span class="sd">        &#39;&#39;&#39;</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="nb">hasattr</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="s1">&#39;_output_file&#39;</span><span class="p">):</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_output_file</span><span class="o">=</span><span class="s1">&#39;&#39;</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_output_file</span>
    <span class="nd">@output_file</span><span class="o">.</span><span class="n">setter</span>
    <span class="k">def</span> <span class="nf">output_file</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="n">value</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_output_file</span> <span class="o">=</span> <span class="sa">f</span><span class="s1">&#39;</span><span class="si">{</span><span class="n">value</span><span class="si">}</span><span class="s1">&#39;</span>

    <span class="nd">@property</span>
    <span class="k">def</span> <span class="nf">output_file_extension</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&#39;&#39;&#39; String</span>

<span class="sd">        Output file extension. Always in the format .sNp, where N depends on the number of ports.</span>
<span class="sd">        Automatically read from the citifile. This should not be changed manually.</span>
<span class="sd">        &#39;&#39;&#39;</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="nb">hasattr</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="s1">&#39;_output_file_extension&#39;</span><span class="p">):</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_output_file_extension</span> <span class="o">=</span> <span class="s1">&#39;&#39;</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_output_file_extension</span>
    <span class="nd">@output_file_extension</span><span class="o">.</span><span class="n">setter</span>
    <span class="k">def</span> <span class="nf">output_file_extension</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="n">value</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_output_file_extension</span> <span class="o">=</span> <span class="n">value</span>

    <span class="nd">@property</span>
    <span class="k">def</span> <span class="nf">nbr_of_ports</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&#39;&#39;&#39;Integer</span>
<span class="sd">        </span>
<span class="sd">        Number of ports in the layout. Automatically read from the citifile. </span>
<span class="sd">        This should not be set manually.</span>
<span class="sd">        &#39;&#39;&#39;</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="nb">hasattr</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="s1">&#39;_nbr_of_ports&#39;</span><span class="p">):</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_nbr_of_ports</span> <span class="o">=</span> <span class="mi">0</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_nbr_of_ports</span>
    <span class="nd">@nbr_of_ports</span><span class="o">.</span><span class="n">setter</span>
    <span class="k">def</span> <span class="nf">nbr_of_ports</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="n">value</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_nbr_of_ports</span> <span class="o">=</span> <span class="n">value</span>

    <span class="nd">@property</span>
    <span class="k">def</span> <span class="nf">normalization</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&#39;&#39;&#39; Integer</span>

<span class="sd">        Normalization value. Automatically read from the citifile. </span>
<span class="sd">        This should not be set manually.</span>
<span class="sd">        &#39;&#39;&#39;</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="nb">hasattr</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="s1">&#39;_normalization&#39;</span><span class="p">):</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_normalization</span> <span class="o">=</span> <span class="mi">0</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_normalization</span>
    <span class="nd">@normalization</span><span class="o">.</span><span class="n">setter</span>
    <span class="k">def</span> <span class="nf">normalization</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="n">value</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_normalization</span> <span class="o">=</span> <span class="n">value</span>

    <span class="nd">@property</span>
    <span class="k">def</span> <span class="nf">comments</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&#39;&#39;&#39; List</span>

<span class="sd">        List of comments in the CITIfile. Automatically read from the citifile. </span>
<span class="sd">        This can not be changed manually.</span>
<span class="sd">        &#39;&#39;&#39;</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="nb">hasattr</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="s1">&#39;_comments&#39;</span><span class="p">):</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_comments</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_comments</span>

    <span class="nd">@property</span>
    <span class="k">def</span> <span class="nf">var_name</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&#39;&#39;&#39; String</span>

<span class="sd">        CITIfile VAR name. Should always be &quot;freq&quot; from Momentum.</span>
<span class="sd">        Automatically read from the citifile. This should not be changed manually.</span>
<span class="sd">        &#39;&#39;&#39;</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="nb">hasattr</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="s1">&#39;_var_name&#39;</span><span class="p">):</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_var_name</span> <span class="o">=</span> <span class="s1">&#39;freq&#39;</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_var_name</span>
    <span class="nd">@var_name</span><span class="o">.</span><span class="n">setter</span>
    <span class="k">def</span> <span class="nf">var_name</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="n">value</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_var_name</span> <span class="o">=</span> <span class="n">value</span>

    <span class="nd">@property</span>
    <span class="k">def</span> <span class="nf">var_format</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&#39;&#39;&#39; String</span>

<span class="sd">        CITIfile VAR format. Should always be &quot;MAG&quot; after reading. Raises error if not.</span>
<span class="sd">        Automatically read from the citifile. This should not be changed manually.</span>
<span class="sd">        &#39;&#39;&#39;</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="nb">hasattr</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="s1">&#39;_var_format&#39;</span><span class="p">):</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_var_format</span> <span class="o">=</span> <span class="s1">&#39;&#39;</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_var_format</span>
    <span class="nd">@var_format</span><span class="o">.</span><span class="n">setter</span>
    <span class="k">def</span> <span class="nf">var_format</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="n">value</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_var_format</span> <span class="o">=</span> <span class="n">value</span>

    <span class="nd">@property</span>
    <span class="k">def</span> <span class="nf">var_nbr_of_points</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&#39;&#39;&#39; Integer</span>

<span class="sd">        Number of frequency points in the CITIfile. This parameter is VERY important,</span>
<span class="sd">        since it is also used to determine the lenghts of the data vectors.</span>

<span class="sd">        Automatically read from the citifile. This should not be changed manually.</span>
<span class="sd">        &#39;&#39;&#39;</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="nb">hasattr</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="s1">&#39;_var_nbr_of_points&#39;</span><span class="p">):</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_var_nbr_of_points</span> <span class="o">=</span> <span class="mi">0</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_var_nbr_of_points</span>
    <span class="nd">@var_nbr_of_points</span><span class="o">.</span><span class="n">setter</span>
    <span class="k">def</span> <span class="nf">var_nbr_of_points</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="n">value</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_var_nbr_of_points</span> <span class="o">=</span> <span class="n">value</span>

    <span class="nd">@property</span>
    <span class="k">def</span> <span class="nf">var_data</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&#39;&#39;&#39; Numpy array</span>

<span class="sd">        Frequency data read from the CITIfile. The lenght of this array is self.var_nbr_of_points.</span>

<span class="sd">        Automatically read from the citifile. This should not be changed manually.</span>
<span class="sd">        &#39;&#39;&#39;</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="nb">hasattr</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="s1">&#39;_var_data&#39;</span><span class="p">):</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_var_data</span> <span class="o">=</span> <span class="kc">None</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_var_data</span>
    <span class="nd">@var_data</span><span class="o">.</span><span class="n">setter</span>
    <span class="k">def</span> <span class="nf">var_data</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="n">value</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_var_data</span> <span class="o">=</span> <span class="n">value</span>

    <span class="nd">@property</span>
    <span class="k">def</span> <span class="nf">data_names</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&#39;&#39;&#39; List</span>

<span class="sd">        List containing all of the S-parameter and Port data names. </span>
<span class="sd">        The order is important, because Momentum does not return any data headers</span>
<span class="sd">        on the CITIfile, so this is used to determine which data vector corresponds to what parameter.</span>

<span class="sd">        Automatically read from the citifile. This can not be changed manually.</span>
<span class="sd">        &#39;&#39;&#39;</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="nb">hasattr</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="s1">&#39;_data_names&#39;</span><span class="p">):</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_data_names</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_data_names</span>

    <span class="nd">@property</span>
    <span class="k">def</span> <span class="nf">data</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&#39;&#39;&#39; Dictionary</span>

<span class="sd">        Contains all the information about the data. The dictionary key is the data name, that can be</span>
<span class="sd">        retreived using self.data_names.</span>
<span class="sd">        </span>
<span class="sd">        The dictionary contains another dictionary containing the following keys:</span>
<span class="sd">            &#39;format&#39; the format of the data. Should always be &quot;RI&quot; from a CITIfile</span>
<span class="sd">            &#39;unit&#39; the unit of the data. Momentum does not seem to output the unit</span>
<span class="sd">            &#39;data&#39; numpy array containing the parameter data. Lenght of this array can be found from self.var_nbr_of_points</span>
<span class="sd">         </span>
<span class="sd">        Automatically read from the citifile. This can not be changed manually.</span>
<span class="sd">        &#39;&#39;&#39;</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="nb">hasattr</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="s1">&#39;_data&#39;</span><span class="p">):</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_data</span> <span class="o">=</span> <span class="p">{}</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_data</span>

    <span class="nd">@property</span>
    <span class="k">def</span> <span class="nf">lines</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&#39;&#39;&#39; List</span>

<span class="sd">        Contains all of the lines in the citifile. If the citifile can not be found,</span>
<span class="sd">        it gives 5 tries with one second delays. IF the citifile is not found after the 5</span>
<span class="sd">        tries, the citifile is not converted to touchstone.</span>
<span class="sd">        </span>
<span class="sd">        Automatically read from the citifile. This should not be changed manually.</span>
<span class="sd">        &#39;&#39;&#39;</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="nb">hasattr</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="s1">&#39;_lines&#39;</span><span class="p">):</span>
            <span class="c1"># Check that given file exists.</span>
            <span class="c1"># Try to see it 5 times, with 1s delays.</span>
            <span class="n">count</span> <span class="o">=</span> <span class="mi">0</span>
            <span class="k">while</span> <span class="ow">not</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">exists</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">input_file</span><span class="p">):</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">print_log</span><span class="p">(</span><span class="nb">type</span><span class="o">=</span><span class="s1">&#39;I&#39;</span><span class="p">,</span><span class="n">msg</span><span class="o">=</span><span class="sa">f</span><span class="s2">&quot;Attempting to find the CITIfile </span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">input_file</span><span class="si">}</span><span class="s2">. Try number </span><span class="si">{</span><span class="n">count</span><span class="o">+</span><span class="mi">1</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
                <span class="k">if</span> <span class="n">count</span> <span class="o">&gt;=</span> <span class="mi">4</span><span class="p">:</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">print_log</span><span class="p">(</span><span class="nb">type</span><span class="o">=</span><span class="s1">&#39;E&#39;</span><span class="p">,</span><span class="n">msg</span><span class="o">=</span><span class="sa">f</span><span class="s2">&quot;Can&#39;t find the CITIfile in the path </span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">input_file</span><span class="si">}</span><span class="s2">.&quot;</span><span class="p">)</span>
                    <span class="k">break</span>
                <span class="n">time</span><span class="o">.</span><span class="n">sleep</span><span class="p">(</span><span class="mi">1</span><span class="p">)</span>
                <span class="n">count</span><span class="o">+=</span><span class="mi">1</span>
            <span class="k">if</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">exists</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">input_file</span><span class="p">):</span>
                <span class="k">with</span> <span class="nb">open</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">input_file</span><span class="p">,</span><span class="s1">&#39;r&#39;</span><span class="p">)</span> <span class="k">as</span> <span class="n">openfile</span><span class="p">:</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">_lines</span> <span class="o">=</span> <span class="n">openfile</span><span class="o">.</span><span class="n">readlines</span><span class="p">()</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">_lines</span><span class="o">=</span><span class="p">[]</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">print_log</span><span class="p">(</span><span class="nb">type</span><span class="o">=</span><span class="s1">&#39;E&#39;</span><span class="p">,</span><span class="n">msg</span><span class="o">=</span><span class="sa">f</span><span class="s2">&quot;File </span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">input_file</span><span class="si">}</span><span class="s2"> does not exist.&quot;</span><span class="p">)</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_lines</span>

<div class="viewcode-block" id="citi_to_touchstone.parse_citi"><a class="viewcode-back" href="../../ads/sections.html#ads.citi_to_touchstone.citi_to_touchstone.parse_citi">[docs]</a>    <span class="k">def</span> <span class="nf">parse_citi</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&#39;&#39;&#39; Automatically called function to parse through the citifile. &#39;&#39;&#39;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">print_log</span><span class="p">(</span><span class="nb">type</span><span class="o">=</span><span class="s1">&#39;I&#39;</span><span class="p">,</span><span class="n">msg</span><span class="o">=</span><span class="sa">f</span><span class="s1">&#39;Parsing </span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">input_file</span><span class="si">}</span><span class="s1"> citifile&#39;</span><span class="p">)</span>
        <span class="n">i</span> <span class="o">=</span> <span class="mi">0</span> <span class="c1"># Which line we are currently reading</span>
        <span class="n">data_sequence_counter</span> <span class="o">=</span> <span class="mi">0</span> <span class="c1"># required, because Momentum citifile does not name the data.</span>
        <span class="k">while</span> <span class="n">i</span> <span class="o">&lt;</span> <span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">lines</span><span class="p">):</span>
            <span class="n">line</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">lines</span><span class="p">[</span><span class="n">i</span><span class="p">]</span><span class="o">.</span><span class="n">strip</span><span class="p">()</span>
            <span class="c1"># Get data from comment lines, convert them to touchstone comments</span>
            <span class="c1"># Which means that &quot;#&quot;-&gt;&quot;!&quot;</span>
            <span class="k">if</span> <span class="n">line</span><span class="o">.</span><span class="n">startswith</span><span class="p">(</span><span class="s1">&#39;#&#39;</span><span class="p">):</span>
                <span class="n">line</span> <span class="o">=</span> <span class="n">line</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="s1">&#39;#&#39;</span><span class="p">,</span><span class="s1">&#39;! &#39;</span><span class="p">)</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">comments</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">line</span><span class="p">)</span>
            <span class="c1"># Skip empty lines </span>
            <span class="k">elif</span> <span class="nb">len</span><span class="p">(</span><span class="n">line</span><span class="p">)</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
                <span class="k">pass</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="c1"># Split the line to max 2 parts using space delimiter</span>
                <span class="n">parts</span> <span class="o">=</span> <span class="n">line</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s1">&#39; &#39;</span><span class="p">,</span><span class="mi">1</span><span class="p">)</span> 
                <span class="c1"># Start checking headers</span>
                <span class="k">if</span> <span class="s1">&#39;CONSTANT&#39;</span> <span class="ow">in</span> <span class="n">parts</span><span class="p">[</span><span class="mi">0</span><span class="p">]:</span>
                    <span class="n">constant</span><span class="p">,</span> <span class="n">value</span> <span class="o">=</span> <span class="n">parts</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s1">&#39; &#39;</span><span class="p">,</span> <span class="mi">1</span><span class="p">)</span>
                    <span class="k">if</span> <span class="s1">&#39;NBR_OF_PORTS&#39;</span> <span class="ow">in</span> <span class="n">constant</span><span class="p">:</span>
                        <span class="bp">self</span><span class="o">.</span><span class="n">nbr_of_ports</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="n">value</span><span class="p">)</span>
                        <span class="bp">self</span><span class="o">.</span><span class="n">output_file_extension</span> <span class="o">=</span> <span class="sa">f</span><span class="s1">&#39;.s</span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">nbr_of_ports</span><span class="si">}</span><span class="s1">p&#39;</span>
                    <span class="k">elif</span> <span class="s1">&#39;NORMALIZATION&#39;</span> <span class="ow">in</span> <span class="n">constant</span><span class="p">:</span>
                        <span class="bp">self</span><span class="o">.</span><span class="n">normalization</span> <span class="o">=</span> <span class="n">value</span>
                <span class="k">elif</span> <span class="n">parts</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">==</span> <span class="s1">&#39;VAR&#39;</span><span class="p">:</span> <span class="c1"># == used to distinguis from VAR_LIST_BEGIN</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">var_name</span><span class="p">,</span><span class="bp">self</span><span class="o">.</span><span class="n">var_format</span><span class="p">,</span><span class="n">var_nbr_of_points</span> <span class="o">=</span> <span class="n">parts</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s1">&#39; &#39;</span><span class="p">)</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">var_nbr_of_points</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="n">var_nbr_of_points</span><span class="p">)</span>
                <span class="k">elif</span> <span class="s1">&#39;DATA&#39;</span> <span class="ow">in</span> <span class="n">parts</span><span class="p">[</span><span class="mi">0</span><span class="p">]:</span>
                    <span class="n">name</span><span class="p">,</span> <span class="n">fmt</span> <span class="o">=</span> <span class="n">parts</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s1">&#39; &#39;</span><span class="p">,</span><span class="mi">1</span><span class="p">)</span>
                    <span class="c1"># Because Momentum doesnt output name with data, have to</span>
                    <span class="c1"># keep track of the order they are given.</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">data_names</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">name</span><span class="p">)</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">data</span><span class="p">[</span><span class="n">name</span><span class="p">]</span> <span class="o">=</span> <span class="p">{</span>
                            <span class="s1">&#39;format&#39;</span><span class="p">:</span> <span class="n">fmt</span><span class="p">,</span>
                            <span class="s1">&#39;unit&#39;</span><span class="p">:</span> <span class="kc">None</span><span class="p">,</span>
                            <span class="s1">&#39;data&#39;</span><span class="p">:</span> <span class="kc">None</span>
                            <span class="p">}</span>
                <span class="k">elif</span> <span class="s1">&#39;VAR_LIST_BEGIN&#39;</span> <span class="ow">in</span> <span class="n">parts</span><span class="p">[</span><span class="mi">0</span><span class="p">]:</span>
                    <span class="c1"># Might contain additional info or might not.</span>
                    <span class="c1"># Have not seen any with momentum so far.</span>
                    <span class="c1"># Check it anyway:</span>
                    <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">parts</span><span class="p">)</span> <span class="o">&gt;</span> <span class="mi">1</span><span class="p">:</span>
                        <span class="n">unit</span> <span class="o">=</span> <span class="n">parts</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s1">&#39; &#39;</span><span class="p">,</span><span class="mi">1</span><span class="p">)[</span><span class="mi">1</span><span class="p">]</span>
                    <span class="k">else</span><span class="p">:</span>
                        <span class="n">unit</span> <span class="o">=</span> <span class="s2">&quot;&quot;</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">var_unit</span> <span class="o">=</span> <span class="n">unit</span>
                    <span class="c1"># Move to next line to find correct row</span>
                    <span class="n">i</span><span class="o">+=</span><span class="mi">1</span> 
                    <span class="c1"># Read from current row to var_nbr_of_points</span>
                    <span class="k">if</span> <span class="s1">&#39;MAG&#39;</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">var_format</span><span class="p">:</span>
                        <span class="bp">self</span><span class="o">.</span><span class="n">var_data</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">loadtxt</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">input_file</span><span class="p">,</span><span class="n">dtype</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">float</span><span class="p">,</span><span class="n">skiprows</span><span class="o">=</span><span class="n">i</span><span class="p">,</span><span class="n">max_rows</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">var_nbr_of_points</span><span class="p">)</span>
                    <span class="k">else</span><span class="p">:</span>
                        <span class="bp">self</span><span class="o">.</span><span class="n">print_log</span><span class="p">(</span><span class="nb">type</span><span class="o">=</span><span class="s1">&#39;E&#39;</span><span class="p">,</span><span class="n">msg</span><span class="o">=</span><span class="sa">f</span><span class="s2">&quot;Frequency format: </span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">var_format</span><span class="si">}</span><span class="s2"> should not exist. Check your CITIFile...&quot;</span><span class="p">)</span>
                    <span class="c1"># Add the numpy read lines to the line number index.</span>
                    <span class="n">i</span><span class="o">+=</span><span class="bp">self</span><span class="o">.</span><span class="n">var_nbr_of_points</span>
                <span class="k">elif</span> <span class="s1">&#39;BEGIN&#39;</span> <span class="ow">in</span> <span class="n">parts</span><span class="p">[</span><span class="mi">0</span><span class="p">]:</span>
                    <span class="c1"># Might contain additional info or might not.</span>
                    <span class="c1"># Have not seen any with momentum so far.</span>
                    <span class="c1"># Check it anyways</span>
                    <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">parts</span><span class="p">)</span> <span class="o">&gt;</span> <span class="mi">1</span><span class="p">:</span>
                        <span class="n">name</span><span class="p">,</span><span class="n">unit</span> <span class="o">=</span> <span class="n">parts</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s1">&#39; &#39;</span><span class="p">,</span><span class="mi">1</span><span class="p">)</span>
                    <span class="k">else</span><span class="p">:</span>
                        <span class="n">name</span> <span class="o">=</span> <span class="kc">None</span> 
                        <span class="n">unit</span> <span class="o">=</span> <span class="s2">&quot;&quot;</span>
                    <span class="c1"># Does not seem to come from Momentum</span>
                    <span class="c1"># Will have to rely on the sequence they were listed earlier.</span>
                    <span class="k">if</span> <span class="ow">not</span> <span class="n">name</span><span class="p">:</span>
                        <span class="n">name</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">data_names</span><span class="p">[</span><span class="n">data_sequence_counter</span><span class="p">]</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">data</span><span class="p">[</span><span class="n">name</span><span class="p">][</span><span class="s1">&#39;unit&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">unit</span> 
                    <span class="c1"># Move to next line containing the data</span>
                    <span class="n">i</span><span class="o">+=</span><span class="mi">1</span>
                    <span class="c1"># Read from current row to current row + var_nbr_of_points</span>
                    <span class="k">if</span> <span class="s1">&#39;RI&#39;</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">data</span><span class="p">[</span><span class="n">name</span><span class="p">][</span><span class="s1">&#39;format&#39;</span><span class="p">]:</span>
                        <span class="bp">self</span><span class="o">.</span><span class="n">data</span><span class="p">[</span><span class="n">name</span><span class="p">][</span><span class="s1">&#39;data&#39;</span><span class="p">]</span><span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">loadtxt</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">input_file</span><span class="p">,</span><span class="n">dtype</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">float</span><span class="p">,</span><span class="n">skiprows</span><span class="o">=</span><span class="n">i</span><span class="p">,</span><span class="n">max_rows</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">var_nbr_of_points</span><span class="p">,</span><span class="n">delimiter</span><span class="o">=</span><span class="s1">&#39;,&#39;</span><span class="p">)</span><span class="o">.</span><span class="n">reshape</span><span class="p">(</span><span class="o">-</span><span class="mi">1</span><span class="p">,</span><span class="mi">2</span><span class="p">)</span>
                    <span class="k">else</span><span class="p">:</span>
                        <span class="bp">self</span><span class="o">.</span><span class="n">print_log</span><span class="p">(</span><span class="nb">type</span><span class="o">=</span><span class="s1">&#39;E&#39;</span><span class="p">,</span><span class="n">msg</span><span class="o">=</span><span class="sa">f</span><span class="s2">&quot;Data format: </span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">data</span><span class="p">[</span><span class="n">name</span><span class="p">][</span><span class="s1">&#39;format&#39;</span><span class="p">]</span><span class="si">}</span><span class="s2"> should not exist. Check your CITIFile...&quot;</span><span class="p">)</span>
                    <span class="c1"># Add the numpy read lines to the index</span>
                    <span class="n">i</span><span class="o">+=</span><span class="bp">self</span><span class="o">.</span><span class="n">var_nbr_of_points</span>
                    <span class="c1"># Add one to the data_sequence_counter, to see which data point is next.</span>
                    <span class="n">data_sequence_counter</span><span class="o">+=</span><span class="mi">1</span>
                <span class="k">else</span><span class="p">:</span>
                    <span class="c1"># Not implemented keyword checks: CITIFILE, COMMENT, VAR_LIST_END, SEG_LIST_BEGIN</span>
                    <span class="c1"># SEG_LIST_END, END and NAME</span>
                    <span class="c1"># Are these required?</span>
                    <span class="k">pass</span>
            <span class="n">i</span><span class="o">+=</span><span class="mi">1</span></div>

<div class="viewcode-block" id="citi_to_touchstone.write_touchstone"><a class="viewcode-back" href="../../ads/sections.html#ads.citi_to_touchstone.citi_to_touchstone.write_touchstone">[docs]</a>    <span class="k">def</span> <span class="nf">write_touchstone</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&#39;&#39;&#39; Automatically called function to generate a Touchstone .sNp file from the data</span>
<span class="sd">        read from the CITIfile.&#39;&#39;&#39;</span>
        <span class="k">try</span><span class="p">:</span>
            <span class="n">filename</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">output_file</span><span class="o">+</span><span class="bp">self</span><span class="o">.</span><span class="n">output_file_extension</span>
            <span class="k">if</span> <span class="ow">not</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">exists</span><span class="p">(</span><span class="n">filename</span><span class="p">):</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">print_log</span><span class="p">(</span><span class="nb">type</span><span class="o">=</span><span class="s1">&#39;I&#39;</span><span class="p">,</span><span class="n">msg</span><span class="o">=</span><span class="sa">f</span><span class="s1">&#39;Writing the S-Parameter data to </span><span class="si">{</span><span class="n">filename</span><span class="si">}</span><span class="s1">&#39;</span><span class="p">)</span>
                <span class="k">with</span> <span class="nb">open</span><span class="p">(</span><span class="n">filename</span><span class="p">,</span><span class="s1">&#39;w&#39;</span><span class="p">)</span> <span class="k">as</span> <span class="n">outfile</span><span class="p">:</span>
                    <span class="c1"># Begin by writing the comments to the file</span>
                    <span class="k">for</span> <span class="n">comment</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">comments</span><span class="p">:</span>
                        <span class="n">outfile</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="n">comment</span><span class="o">+</span><span class="s1">&#39;</span><span class="se">\n</span><span class="s1">&#39;</span><span class="p">)</span>
                    <span class="c1"># Write normalization info to the sNp file as comment</span>
                    <span class="n">outfile</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="sa">f</span><span class="s1">&#39;! NORMALIZATION: </span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">normalization</span><span class="si">}</span><span class="se">\n</span><span class="s1">&#39;</span><span class="p">)</span>
                    <span class="c1"># Write the data header part</span>
                    <span class="c1"># Documentation for the data header part:</span>
                    <span class="c1"># &quot;# &lt;FREQ_UNITS&gt;  &lt;TYPE&gt;  &lt;FORMAT&gt;  &lt;Rn&gt;&quot;, where &quot;#&quot; is the option line delimiter.</span>
                    <span class="c1">#&lt;FREQ_UNITS&gt; = Units of the frequency data. Options are GHz, MHz, KHz, or Hz.</span>
                    <span class="c1">#&lt;TYPE&gt; = Type of file data. Options are:  S, Y or Z for S1P components, S, Y, Z, G, or H for S2P components, S for 3 or more ports</span>
                    <span class="c1">#&lt;FORMAT&gt; = S-parameter format. Options are: DB for dB-angle, MA for magnitude angle, RI for real-imaginary</span>
                    <span class="c1">#&lt;Rn&gt; = Reference resistance in ohms, where n is a positive number. This is the impedance the S-parameters were normalized to.</span>
                    <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">var_unit</span> <span class="o">==</span> <span class="s1">&#39;&#39;</span><span class="p">:</span>
                        <span class="n">freq_unit</span> <span class="o">=</span> <span class="s1">&#39;hz&#39;</span> <span class="c1"># Is this true? Seems to be working...</span>
                    <span class="c1"># Assumption: all ports have same impedance. It does not seem possible to define different</span>
                    <span class="c1"># port impedances in touchstone format.</span>
                    <span class="n">outfile</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="sa">f</span><span class="s1">&#39;# </span><span class="si">{</span><span class="n">freq_unit</span><span class="si">}</span><span class="s1"> S </span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">data</span><span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">data_names</span><span class="p">[</span><span class="mi">0</span><span class="p">]][</span><span class="s2">&quot;format&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">lower</span><span class="p">()</span><span class="si">}</span><span class="s1"> R </span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">data</span><span class="p">[</span><span class="s2">&quot;PORTZ[1]&quot;</span><span class="p">][</span><span class="s2">&quot;data&quot;</span><span class="p">][</span><span class="mi">0</span><span class="p">][</span><span class="mi">0</span><span class="p">]</span><span class="si">}</span><span class="se">\n</span><span class="s1">&#39;</span><span class="p">)</span>
                    <span class="c1"># Another comment that is often in Touchstone files</span>
                    <span class="n">outfile</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="sa">f</span><span class="s1">&#39;! </span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">nbr_of_ports</span><span class="si">}</span><span class="s1"> Port Network Data from data block</span><span class="se">\n</span><span class="s1">&#39;</span><span class="p">)</span>
                    <span class="c1"># For some ungodly reason, Touchstone has different logic / order of ports for 2-port than any other</span>
                    <span class="c1"># amount of ports... Also for less than 3 ports, data comes on the same line.</span>
                    <span class="c1"># 2 ports:</span>
                    <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">nbr_of_ports</span> <span class="o">==</span> <span class="mi">2</span><span class="p">:</span>
                        <span class="c1"># Positions hard coded. Since Keysight Momentum does not label the data in the citifile, this is probably the only way</span>
                        <span class="n">S11</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">data_names</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
                        <span class="n">S12</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">data_names</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span>
                        <span class="n">S21</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">data_names</span><span class="p">[</span><span class="mi">2</span><span class="p">]</span>
                        <span class="n">S22</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">data_names</span><span class="p">[</span><span class="mi">3</span><span class="p">]</span>
                        <span class="c1"># S11 S21 S12 S22 is the order for 2-port...</span>
                        <span class="c1"># Write this to the file to improve readability.</span>
                        <span class="n">outfile</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="sa">f</span><span class="s1">&#39;! freq Re</span><span class="si">{</span><span class="n">S11</span><span class="si">}</span><span class="s1"> Im</span><span class="si">{</span><span class="n">S11</span><span class="si">}</span><span class="s1"> Re</span><span class="si">{</span><span class="n">S21</span><span class="si">}</span><span class="s1"> Im</span><span class="si">{</span><span class="n">S21</span><span class="si">}</span><span class="s1"> Re</span><span class="si">{</span><span class="n">S12</span><span class="si">}</span><span class="s1"> Im</span><span class="si">{</span><span class="n">S12</span><span class="si">}</span><span class="s1"> Re</span><span class="si">{</span><span class="n">S22</span><span class="si">}</span><span class="s1"> Im</span><span class="si">{</span><span class="n">S22</span><span class="si">}</span><span class="se">\n</span><span class="s1">! </span><span class="se">\n</span><span class="s1">&#39;</span><span class="p">)</span>
                        <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">var_nbr_of_points</span><span class="p">):</span>
                            <span class="c1"># Hope that Keysight does not change the order the data comes in</span>
                            <span class="n">S11_data</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">data</span><span class="p">[</span><span class="n">S11</span><span class="p">][</span><span class="s2">&quot;data&quot;</span><span class="p">][</span><span class="n">i</span><span class="p">]</span> <span class="c1"># Index 0 = real values, 1 = imaginary.</span>
                            <span class="n">S12_data</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">data</span><span class="p">[</span><span class="n">S12</span><span class="p">][</span><span class="s2">&quot;data&quot;</span><span class="p">][</span><span class="n">i</span><span class="p">]</span>
                            <span class="n">S21_data</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">data</span><span class="p">[</span><span class="n">S21</span><span class="p">][</span><span class="s2">&quot;data&quot;</span><span class="p">][</span><span class="n">i</span><span class="p">]</span>
                            <span class="n">S22_data</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">data</span><span class="p">[</span><span class="n">S22</span><span class="p">][</span><span class="s2">&quot;data&quot;</span><span class="p">][</span><span class="n">i</span><span class="p">]</span>
                            <span class="n">datastring</span> <span class="o">=</span> <span class="sa">f</span><span class="s1">&#39;</span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">var_data</span><span class="p">[</span><span class="n">i</span><span class="p">]</span><span class="si">}</span><span class="s1"> </span><span class="si">{</span><span class="n">S11_data</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="si">}</span><span class="s1"> </span><span class="si">{</span><span class="n">S11_data</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="si">}</span><span class="s1"> </span><span class="si">{</span><span class="n">S21_data</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="si">}</span><span class="s1"> </span><span class="si">{</span><span class="n">S21_data</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="si">}</span><span class="s1"> </span><span class="si">{</span><span class="n">S12_data</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="si">}</span><span class="s1"> </span><span class="si">{</span><span class="n">S12_data</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="si">}</span><span class="s1"> </span><span class="si">{</span><span class="n">S22_data</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="si">}</span><span class="s1"> </span><span class="si">{</span><span class="n">S22_data</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="si">}</span><span class="se">\n</span><span class="s1">&#39;</span> 
                            <span class="n">outfile</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="n">datastring</span><span class="p">)</span>
                    <span class="k">else</span><span class="p">:</span>
                        <span class="c1"># Write the comment outlining the structure of the file. Makes readability better</span>
                        <span class="n">nextstring</span> <span class="o">=</span> <span class="s1">&#39;! freq &#39;</span>
                        <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">data_names</span><span class="p">)):</span>
                            <span class="c1"># List all of the ports not including the port impedances.</span>
                            <span class="k">if</span> <span class="ow">not</span> <span class="s1">&#39;PORTZ&#39;</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">data_names</span><span class="p">[</span><span class="n">i</span><span class="p">]:</span>
                                <span class="n">nextstring</span> <span class="o">=</span> <span class="n">nextstring</span> <span class="o">+</span> <span class="sa">f</span><span class="s1">&#39;Re</span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">data_names</span><span class="p">[</span><span class="n">i</span><span class="p">]</span><span class="si">}</span><span class="s1"> Im</span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">data_names</span><span class="p">[</span><span class="n">i</span><span class="p">]</span><span class="si">}</span><span class="s1"> &#39;</span>
                                <span class="c1"># Add linebreak after listing every port.</span>
                                <span class="k">if</span> <span class="p">(</span><span class="n">i</span><span class="o">+</span><span class="mi">1</span><span class="p">)</span> <span class="o">%</span> <span class="bp">self</span><span class="o">.</span><span class="n">nbr_of_ports</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span> <span class="c1">#i+1 to avoid first linebreak on the first line</span>
                                    <span class="c1"># Add linebreak and create new comment line</span>
                                    <span class="n">nextstring</span> <span class="o">=</span> <span class="n">nextstring</span> <span class="o">+</span> <span class="s1">&#39;</span><span class="se">\n</span><span class="s1">!      &#39;</span> 
                            <span class="c1"># Stop writing when it starts listing the port impedances</span>
                            <span class="k">else</span><span class="p">:</span>
                                <span class="k">break</span>
                        <span class="c1"># Write it to the file, add final linebreak.</span>
                        <span class="n">outfile</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="n">nextstring</span><span class="o">+</span><span class="s1">&#39;</span><span class="se">\n</span><span class="s1">&#39;</span><span class="p">)</span>
                        <span class="c1"># Writing the actual data.</span>
                        <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">var_nbr_of_points</span><span class="p">):</span>
                            <span class="n">nextstring</span> <span class="o">=</span> <span class="sa">f</span><span class="s1">&#39;</span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">var_data</span><span class="p">[</span><span class="n">i</span><span class="p">]</span><span class="si">}</span><span class="s1"> &#39;</span> <span class="c1"># Frequency</span>
                            <span class="k">for</span> <span class="n">j</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">data_names</span><span class="p">)):</span>
                                <span class="k">if</span> <span class="ow">not</span> <span class="s1">&#39;PORTZ&#39;</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">data_names</span><span class="p">[</span><span class="n">j</span><span class="p">]:</span> <span class="c1"># a solution to skip Z-port data</span>
                                    <span class="n">nextstring</span> <span class="o">=</span> <span class="sa">f</span><span class="s1">&#39;</span><span class="si">{</span><span class="n">nextstring</span><span class="si">}</span><span class="s1"> </span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">data</span><span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">data_names</span><span class="p">[</span><span class="n">j</span><span class="p">]][</span><span class="s2">&quot;data&quot;</span><span class="p">][</span><span class="n">i</span><span class="p">][</span><span class="mi">0</span><span class="p">]</span><span class="si">}</span><span class="s1"> </span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">data</span><span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">data_names</span><span class="p">[</span><span class="n">j</span><span class="p">]][</span><span class="s2">&quot;data&quot;</span><span class="p">][</span><span class="n">i</span><span class="p">][</span><span class="mi">1</span><span class="p">]</span> <span class="si">}</span><span class="s1">&#39;</span>
                                    <span class="c1"># Add linebreak after listing every port.</span>
                                    <span class="c1"># Example for 3-port:</span>
                                    <span class="c1"># &lt;FREQ&gt;  |S11|  &lt;S11  |S12|  &lt;S12  |S13|  &lt;S13</span>
                                    <span class="c1">#         |S21|  &lt;S21  |S22|  &lt;S22  |S23|  &lt;S23</span>
                                    <span class="c1">#         |S31|  &lt;S31  |S32|  &lt;S32  |S33|  &lt;S33</span>
                                    <span class="k">if</span> <span class="p">(</span><span class="n">j</span><span class="o">+</span><span class="mi">1</span><span class="p">)</span> <span class="o">%</span> <span class="bp">self</span><span class="o">.</span><span class="n">nbr_of_ports</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span> <span class="c1">#j+1 to avoid first linebreak on the first line</span>
                                        <span class="n">nextstring</span> <span class="o">=</span> <span class="n">nextstring</span> <span class="o">+</span> <span class="s1">&#39;</span><span class="se">\n</span><span class="s1">&#39;</span>
                                <span class="k">else</span><span class="p">:</span>
                                    <span class="k">break</span>
                            <span class="n">outfile</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="n">nextstring</span><span class="o">+</span><span class="s1">&#39;</span><span class="se">\n</span><span class="s1">&#39;</span><span class="p">)</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">print_log</span><span class="p">(</span><span class="nb">type</span><span class="o">=</span><span class="s1">&#39;E&#39;</span><span class="p">,</span><span class="n">msg</span><span class="o">=</span><span class="sa">f</span><span class="s2">&quot;File: </span><span class="si">{</span><span class="n">filename</span><span class="si">}</span><span class="s2"> already exists!&quot;</span><span class="p">)</span>
        <span class="k">except</span> <span class="ne">AttributeError</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">print_log</span><span class="p">(</span><span class="nb">type</span><span class="o">=</span><span class="s1">&#39;E&#39;</span><span class="p">,</span><span class="n">msg</span><span class="o">=</span><span class="s2">&quot;Error writing the S-Parameter Touchstone file.&quot;</span><span class="p">)</span></div>
    
<div class="viewcode-block" id="citi_to_touchstone.generate_contents"><a class="viewcode-back" href="../../ads/sections.html#ads.citi_to_touchstone.citi_to_touchstone.generate_contents">[docs]</a>    <span class="k">def</span> <span class="nf">generate_contents</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&#39;&#39;&#39; Externally called function to read the citifile data and generate the touchstone file.&#39;&#39;&#39;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">parse_citi</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">write_touchstone</span><span class="p">()</span></div></div>
</pre></div>

           </div>
          </div>
          <footer>

  <hr/>

  <div role="contentinfo">
    <p>&#169; Copyright 2019 TheSyDeKick Community.</p>
  </div>

  Built with <a href="https://www.sphinx-doc.org/">Sphinx</a> using a
    <a href="https://github.com/readthedocs/sphinx_rtd_theme">theme</a>
    provided by <a href="https://readthedocs.org">Read the Docs</a>.
   

</footer>
        </div>
      </div>
    </section>
  </div>
  <script>
      jQuery(function () {
          SphinxRtdTheme.Navigation.enable(true);
      });
  </script> 

</body>
</html>